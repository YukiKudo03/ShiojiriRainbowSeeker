{
  "id": "snapshot_1768934663380_8bc7aonvb",
  "approvalId": "approval_1768934604270_2y8g7be6n",
  "approvalTitle": "Requirements Document for ShiojiriRainbowSeeker",
  "version": 2,
  "timestamp": "2026-01-20T18:44:23.380Z",
  "trigger": "revision_requested",
  "status": "pending",
  "content": "# Requirements Document\n\n## Overview\n\n**ShiojiriRainbowSeeker** is a community-driven mobile application designed for residents and visitors of Shiojiri City (and surrounding areas) to discover, share, and celebrate rainbow sightings. The app enables users to capture rainbow photos with precise GPS location data and comments, building a shared photo gallery of rainbow moments. Additionally, the app provides real-time notifications when weather conditions are favorable for rainbow formation, helping users catch these fleeting natural phenomena.\n\nThe application serves two primary purposes:\n1. **Rainbow Photo Sharing**: A community platform where users can upload rainbow photos with location data and comments, creating a visual archive of rainbow sightings in the region\n2. **Rainbow Appearance Notifications**: Push notifications that alert users when atmospheric conditions suggest a rainbow may be visible, based on weather data analysis\n\n### Alignment with Product Vision\n\nThis is a new project establishing the ShiojiriRainbowSeeker platform. The product vision centers on:\n- Building community engagement around natural phenomena appreciation\n- Leveraging modern mobile capabilities (GPS, camera, push notifications)\n- Creating a location-based social experience focused on positive, uplifting content\n- Promoting outdoor awareness and connection with nature in the Shiojiri region\n\n## User Stories\n\n### US-1: User Registration\n**As a** new user\n**I want** to create an account and log in securely\n**So that** I can save my rainbow photos and receive personalized notifications\n\n### US-2: Rainbow Photo Capture\n**As a** registered user\n**I want** to capture or upload rainbow photos with my location automatically tagged\n**So that** I can share my rainbow sighting with the community\n\n### US-3: Photo Comments\n**As a** registered user\n**I want** to add comments and descriptions to my rainbow photos\n**So that** I can share context about the sighting\n\n### US-4: Browse Gallery\n**As a** user (registered or guest)\n**I want** to browse rainbow photos shared by the community\n**So that** I can enjoy and discover rainbow sightings across the region\n\n### US-5: Map Exploration\n**As a** user\n**I want** to see rainbow sightings displayed on a map\n**So that** I can discover where rainbows have been spotted geographically\n\n### US-6: Rainbow Notifications\n**As a** registered user\n**I want** to receive push notifications when conditions are favorable for rainbow sightings\n**So that** I don't miss potential rainbow moments\n\n### US-7: Notification Preferences\n**As a** registered user\n**I want** to customize my notification settings\n**So that** I only receive alerts that are relevant to me\n\n### US-8: Social Interactions\n**As a** registered user\n**I want** to interact with other users' rainbow photos (like, comment)\n**So that** I can engage with the community\n\n### US-9: Profile Management\n**As a** registered user\n**I want** to manage my profile and view my uploaded photos\n**So that** I can track my contributions and personalize my experience\n\n### US-10: Content Moderation\n**As an** administrator\n**I want** to review and moderate reported content\n**So that** I can maintain a safe and positive community environment\n\n### US-11: First-Time Onboarding\n**As a** new user\n**I want** a guided introduction to the app's features\n**So that** I can quickly understand how to use the app effectively\n\n### US-12: Data Management\n**As a** registered user\n**I want** to export or delete my personal data\n**So that** I have control over my information (GDPR compliance)\n\n## Functional Requirements\n\n### FR-1: User Authentication\nSecure user registration and authentication system supporting email/password login.\n\n**Priority**: High\n**Dependencies**: Email service for verification\n\n#### Acceptance Criteria\n- [ ] **AC-1.1**: WHEN a user opens the app for the first time THEN the system SHALL display registration/login options\n- [ ] **AC-1.2**: WHEN a user registers with email and password THEN the system SHALL create an account and send email verification\n- [ ] **AC-1.3**: IF a user provides invalid email format THEN the system SHALL display an appropriate error message\n- [ ] **AC-1.4**: WHEN a user logs in with valid credentials THEN the system SHALL authenticate and redirect to the main screen\n- [ ] **AC-1.5**: IF a user enters incorrect credentials THEN the system SHALL display an error and allow retry (max 5 attempts before temporary lockout)\n- [ ] **AC-1.6**: WHEN a user requests password reset THEN the system SHALL send a reset link to the registered email\n- [ ] **AC-1.7**: IF email verification fails (invalid token, expired) THEN the system SHALL display error and offer to resend verification\n\n### FR-2: Photo Capture and Upload\nEnable users to capture or select rainbow photos with automatic GPS tagging and upload to the platform.\n\n**Priority**: High\n**Dependencies**: Device camera access, GPS/location services, image storage service\n\n#### Acceptance Criteria\n- [ ] **AC-2.1**: WHEN a user taps the camera button THEN the system SHALL open the device camera with location services enabled\n- [ ] **AC-2.2**: WHEN a user captures a photo THEN the system SHALL automatically embed GPS coordinates (latitude, longitude) in the image metadata\n- [ ] **AC-2.3**: IF GPS is unavailable or inaccurate THEN the system SHALL allow manual location selection on a map\n- [ ] **AC-2.4**: WHEN a user selects a photo from gallery THEN the system SHALL extract existing GPS data or prompt for location input\n- [ ] **AC-2.5**: WHEN uploading a photo THEN the system SHALL compress the image to JPEG quality 80% with maximum file size 2MB\n- [ ] **AC-2.6**: WHEN a photo is uploaded successfully THEN the system SHALL display a confirmation message\n- [ ] **AC-2.7**: IF upload fails due to network error THEN the system SHALL queue the photo for automatic retry when connection is restored\n- [ ] **AC-2.8**: IF upload fails due to server error THEN the system SHALL notify the user and allow manual retry\n- [ ] **AC-2.9**: IF photo file size exceeds 10MB before compression THEN the system SHALL display an error suggesting the user select a smaller image\n\n### FR-3: Photo Comments and Metadata\nAllow users to add descriptive information to their rainbow photos.\n\n**Priority**: Medium\n**Dependencies**: FR-2 (Photo Upload)\n\n#### Acceptance Criteria\n- [ ] **AC-3.1**: WHEN a user uploads a photo THEN the system SHALL provide fields for title (optional, max 100 characters) and description/comment (optional, max 500 characters)\n- [ ] **AC-3.2**: WHEN a user adds a comment THEN the system SHALL store it with the photo along with timestamp\n- [ ] **AC-3.3**: IF a comment exceeds 500 characters THEN the system SHALL display remaining character count and prevent submission\n- [ ] **AC-3.4**: WHEN viewing a photo THEN the system SHALL display the location name (reverse geocoded), date/time, and any comments\n- [ ] **AC-3.5**: WHEN a user views their own photo THEN the system SHALL allow editing of title and comments\n\n### FR-4: Photo Gallery and Feed\nDisplay a browsable feed of community rainbow photos with filtering capabilities.\n\n**Priority**: High\n**Dependencies**: FR-2 (Photo Upload), Image CDN\n\n#### Acceptance Criteria\n- [ ] **AC-4.1**: WHEN a user opens the app THEN the system SHALL display a feed of recent rainbow photos sorted by date (newest first)\n- [ ] **AC-4.2**: WHEN a user scrolls the feed THEN the system SHALL load additional photos with infinite scroll pagination (20 photos per page)\n- [ ] **AC-4.3**: WHEN a user taps on a photo THEN the system SHALL display full-screen view with location, date, and comments\n- [ ] **AC-4.4**: WHEN a user filters by location THEN the system SHALL show only photos from within the selected area radius\n- [ ] **AC-4.5**: WHEN a user filters by date range THEN the system SHALL show photos within the specified period\n- [ ] **AC-4.6**: WHEN a user searches by keyword THEN the system SHALL return photos with matching titles or comments\n- [ ] **AC-4.7**: IF no photos match the current filter/search THEN the system SHALL display an empty state message with suggestions\n- [ ] **AC-4.8**: IF feed loading fails THEN the system SHALL display an error message with retry option\n\n### FR-5: Map View\nDisplay rainbow sightings on an interactive map with clustering and location-based features.\n\n**Priority**: Medium\n**Dependencies**: Map provider service (Mapbox or Google Maps)\n\n#### Acceptance Criteria\n- [ ] **AC-5.1**: WHEN a user switches to map view THEN the system SHALL display a map with markers for each rainbow photo location\n- [ ] **AC-5.2**: WHEN a user taps a map marker THEN the system SHALL show a preview of the photo(s) at that location\n- [ ] **AC-5.3**: WHEN multiple photos exist within 500 meters of each other THEN the system SHALL cluster markers and show count\n- [ ] **AC-5.4**: WHEN a user's location is available THEN the system SHALL center the map on their current position initially\n- [ ] **AC-5.5**: WHEN a user zooms or pans the map THEN the system SHALL load relevant markers dynamically within the visible region\n- [ ] **AC-5.6**: IF device is offline THEN the system SHALL display cached map tiles and markers from previous sessions\n\n### FR-6: Rainbow Notification System\nSend push notifications when weather conditions indicate potential rainbow visibility.\n\n**Priority**: High\n**Dependencies**: Weather API service, Push notification service (FCM/APNs)\n\n#### Acceptance Criteria\n- [ ] **AC-6.1**: WHEN a user enables notifications THEN the system SHALL register their notification location (current GPS or user-selected fixed location)\n- [ ] **AC-6.2**: WHEN weather conditions indicate rainbow likelihood (humidity > 70%, sun angle 40-42 degrees from horizon, recent precipitation within 30 minutes) THEN the system SHALL send a push notification\n- [ ] **AC-6.3**: WHEN a notification is sent THEN it SHALL include the likely direction to look (e.g., \"Look East\") and estimated visibility duration\n- [ ] **AC-6.4**: IF a user disables notifications THEN the system SHALL immediately stop sending alerts\n- [ ] **AC-6.5**: WHEN weather API data suggests favorable conditions within 30 minutes THEN the system SHALL send an advance notification\n- [ ] **AC-6.6**: WHEN a user taps a notification THEN the system SHALL open the app to the camera screen\n- [ ] **AC-6.7**: IF multiple favorable conditions occur within 2 hours THEN the system SHALL send maximum one notification (throttling)\n- [ ] **AC-6.8**: IF weather API is unavailable THEN the system SHALL skip notification check and retry on next interval\n\n### FR-7: Notification Preferences\nAllow users to customize their notification settings for personalized alerts.\n\n**Priority**: Medium\n**Dependencies**: FR-6 (Notification System)\n\n#### Acceptance Criteria\n- [ ] **AC-7.1**: WHEN a user accesses settings THEN the system SHALL display notification preference options\n- [ ] **AC-7.2**: WHEN a user sets a location radius (1km, 5km, 10km, 25km options) THEN the system SHALL only send notifications for conditions in that area\n- [ ] **AC-7.3**: WHEN a user sets quiet hours (start time, end time) THEN the system SHALL not send notifications during those times\n- [ ] **AC-7.4**: WHEN a user toggles notification types THEN the system SHALL respect individual preferences (rainbow alerts, community activity separately)\n- [ ] **AC-7.5**: WHEN preferences are saved THEN the system SHALL persist them across sessions and sync to server for cross-device consistency\n- [ ] **AC-7.6**: IF quiet hours conflict with advance notification timing THEN the system SHALL defer notification until quiet hours end\n\n### FR-8: Social Interactions\nEnable community engagement through likes and comments on photos.\n\n**Priority**: Medium\n**Dependencies**: FR-4 (Gallery)\n\n#### Acceptance Criteria\n- [ ] **AC-8.1**: WHEN a user taps the like button on a photo THEN the system SHALL increment the like count and record the interaction\n- [ ] **AC-8.2**: WHEN a user comments on a photo THEN the system SHALL add the comment to the photo's comment thread with timestamp\n- [ ] **AC-8.3**: WHEN a user receives a like or comment on their photo THEN the system SHALL send a notification (if enabled)\n- [ ] **AC-8.4**: WHEN a user views a photo THEN the system SHALL display total likes and comment count\n- [ ] **AC-8.5**: WHEN a user reports inappropriate content THEN the system SHALL flag it for review, acknowledge the report, and hide content from reporter\n- [ ] **AC-8.6**: IF comment contains prohibited words THEN the system SHALL block submission and display warning\n- [ ] **AC-8.7**: IF user attempts to like the same photo twice THEN the system SHALL toggle (unlike) the previous like\n\n### FR-9: User Profile\nProvide users with profile management and personal photo gallery access.\n\n**Priority**: Medium\n**Dependencies**: FR-1 (Authentication), FR-2 (Photo Upload)\n\n#### Acceptance Criteria\n- [ ] **AC-9.1**: WHEN a user accesses their profile THEN the system SHALL display username, profile photo, and statistics (photos uploaded, likes received, total comments)\n- [ ] **AC-9.2**: WHEN a user edits their profile THEN the system SHALL allow changing display name (3-30 characters) and profile photo\n- [ ] **AC-9.3**: WHEN a user views \"My Photos\" THEN the system SHALL display all their uploaded rainbow photos in grid view\n- [ ] **AC-9.4**: WHEN a user deletes a photo THEN the system SHALL show confirmation dialog and remove it from the gallery upon confirmation\n- [ ] **AC-9.5**: WHEN a user logs out THEN the system SHALL clear local session data and return to login screen\n\n### FR-10: Content Moderation\nEnable administrators to review and manage reported content.\n\n**Priority**: Medium\n**Dependencies**: FR-8 (Social Interactions)\n\n#### Acceptance Criteria\n- [ ] **AC-10.1**: WHEN content is reported THEN the system SHALL add it to a moderation queue with report reason and reporter info\n- [ ] **AC-10.2**: WHEN an admin reviews content THEN the system SHALL allow approve (dismiss report), hide (remove from public view), or delete (permanent removal) actions\n- [ ] **AC-10.3**: WHEN content is hidden or deleted THEN the system SHALL notify the content owner with reason\n- [ ] **AC-10.4**: WHEN a user receives multiple content violations (3+) THEN the system SHALL flag their account for review\n\n### FR-11: Onboarding Flow\nGuide new users through app features during first launch.\n\n**Priority**: Low\n**Dependencies**: None\n\n#### Acceptance Criteria\n- [ ] **AC-11.1**: WHEN a user completes registration THEN the system SHALL display an optional onboarding flow (skippable)\n- [ ] **AC-11.2**: WHEN onboarding is shown THEN it SHALL include 4-5 screens covering: photo capture, gallery browsing, map view, and notifications\n- [ ] **AC-11.3**: WHEN a user completes or skips onboarding THEN the system SHALL mark it complete and not show again\n- [ ] **AC-11.4**: WHEN a user wants to revisit onboarding THEN it SHALL be accessible from settings menu\n\n### FR-12: Data Export and Deletion\nEnable users to export or delete their personal data for GDPR compliance.\n\n**Priority**: Medium\n**Dependencies**: FR-1 (Authentication), FR-2 (Photo Upload)\n\n#### Acceptance Criteria\n- [ ] **AC-12.1**: WHEN a user requests data export THEN the system SHALL generate a downloadable archive (ZIP) containing their photos, comments, and profile data within 48 hours\n- [ ] **AC-12.2**: WHEN a user requests account deletion THEN the system SHALL show confirmation with consequences and 14-day grace period\n- [ ] **AC-12.3**: IF grace period passes without cancellation THEN the system SHALL permanently delete all user data\n- [ ] **AC-12.4**: WHEN data is deleted THEN the system SHALL remove photos from CDN, database records, and anonymize any remaining references\n\n## Technical Constraints\n\n- **Mobile Platforms**: iOS 14+ and Android API level 26+ (Android 8.0+)\n- **Framework**: Cross-platform development using React Native or Flutter\n- **Backend**: Node.js with Express or similar REST API framework\n- **Database**: PostgreSQL for relational data, with PostGIS extension for geospatial queries\n- **Weather API Rate Limits**: Maximum 60 calls/minute for free tier; implement caching to reduce API calls\n- **Push Notification Limits**: FCM has no hard limit; APNs requires certificate management\n- **Image Storage**: Maximum 10GB per user; implement cleanup policy for inactive accounts\n\n## Dependencies\n\n| Dependency | Purpose | Provider Options |\n|------------|---------|------------------|\n| Weather API | Rainbow condition detection | OpenWeatherMap, WeatherAPI, Visual Crossing |\n| Map Provider | Map display and geocoding | Google Maps, Mapbox, Apple Maps |\n| Push Notifications | Real-time alerts | Firebase Cloud Messaging (Android), APNs (iOS) |\n| Image Storage/CDN | Photo storage and delivery | AWS S3 + CloudFront, Cloudflare R2, Google Cloud Storage |\n| Email Service | Verification and notifications | SendGrid, AWS SES, Mailgun |\n| Geolocation | Reverse geocoding | Google Geocoding API, Mapbox Geocoding |\n\n## Out of Scope\n\nThe following items are explicitly NOT included in this version:\n\n- Web application (mobile-only for v1.0)\n- Custom rainbow prediction algorithm development (using existing weather API data)\n- Paid/premium subscription features\n- Direct social media sharing integration (Instagram, Twitter, etc.)\n- Video capture and sharing\n- Real-time chat or messaging between users\n- Weather forecast display beyond rainbow notifications\n- Multi-region expansion beyond Shiojiri area (v1.0 focus)\n- AR (Augmented Reality) features\n\n## Non-Functional Requirements\n\n### NFR-1: Code Architecture and Modularity\n- **Single Responsibility Principle**: Each file should have a single, well-defined purpose (e.g., separate services for auth, photos, notifications)\n- **Modular Design**: Components, utilities, and services should be isolated and reusable\n- **Dependency Management**: Minimize interdependencies between modules; use dependency injection where appropriate\n- **Clear Interfaces**: Define clean contracts between components and layers (API, service, data, presentation)\n\n### NFR-2: Performance\n- Photo uploads shall complete within 10 seconds on 10 Mbps connections\n- Feed loading shall display initial content within 2 seconds\n- Map rendering shall maintain 60fps during pan/zoom operations\n- Push notifications shall be delivered within 5 minutes of favorable weather detection\n- App launch to usable state shall be under 3 seconds on mid-range devices\n\n### NFR-3: Security\n- All API communications must use HTTPS/TLS 1.3\n- User passwords must be hashed using bcrypt with minimum 12 salt rounds\n- JWT tokens for authentication with appropriate expiration (access: 15min, refresh: 7 days)\n- Photo metadata shall not expose sensitive user information beyond chosen display name and location\n- Implement rate limiting on authentication endpoints (max 10 attempts per IP per minute)\n- Input sanitization to prevent XSS and SQL injection attacks\n\n### NFR-4: Reliability\n- System shall maintain 99.5% uptime availability\n- Photo uploads shall support resume capability for interrupted connections\n- Offline mode shall allow photo capture with automatic upload when connectivity returns\n- Database shall implement daily backups with 30-day retention and point-in-time recovery capability\n- Graceful degradation when external services (weather API, maps) are unavailable\n\n### NFR-5: Usability\n- App shall support both English and Japanese languages\n- UI shall be accessible following WCAG 2.1 AA guidelines\n- Touch targets shall be minimum 44x44 points\n- App shall support both light and dark mode themes\n- Onboarding flow shall introduce key features in under 2 minutes\n- Error messages shall be user-friendly and actionable\n\n### NFR-6: Scalability\n- Architecture shall support horizontal scaling for increased user load\n- Image storage shall use CDN for efficient delivery with target latency under 200ms globally\n- Database design shall accommodate growth to 100,000+ photos and 10,000+ users\n- API design shall support pagination and filtering for efficient data retrieval\n\n### NFR-7: Privacy and Data Protection\n- Comply with GDPR and Japan's APPI (Act on Protection of Personal Information)\n- Users must explicitly consent to location data collection\n- Location data precision shall be configurable (exact vs. approximate)\n- Data retention policy: inactive accounts archived after 2 years, deleted after 3 years\n- Privacy policy and terms of service must be accessible in-app\n\n### NFR-8: Logging and Monitoring\n- All API requests shall be logged with timestamp, endpoint, response time, and status code\n- Error tracking shall capture stack traces and user context (anonymized)\n- System health metrics (CPU, memory, database connections) shall be monitored\n- Alert thresholds shall trigger notifications for error rate > 5% or response time > 3s\n\n## Glossary\n\n| Term | Definition |\n|------|------------|\n| Rainbow Likelihood | Weather conditions favorable for rainbow formation: humidity > 70%, sun angle 40-42Â° from horizon, recent precipitation within 30 minutes |\n| Geocoding | Converting GPS coordinates to human-readable address |\n| Reverse Geocoding | Converting address to GPS coordinates |\n| EARS Format | Easy Approach to Requirements Syntax using WHEN/IF/THEN statements |\n| CDN | Content Delivery Network for distributed content delivery |\n| Push Notification | Server-initiated message delivered to user's device |\n| Quiet Hours | User-defined time period when notifications are suppressed |\n| Clustering | Grouping nearby map markers (within 500m) into a single marker showing count |\n",
  "fileStats": {
    "size": 21670,
    "lines": 356,
    "lastModified": "2026-01-20T18:43:08.237Z"
  },
  "comments": []
}