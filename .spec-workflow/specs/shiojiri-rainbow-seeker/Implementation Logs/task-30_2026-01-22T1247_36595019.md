# Implementation Log: Task 30

**Summary:** プッシュ通知基盤を構築。FCM (Firebase Cloud Messaging) と APNs (Apple Push Notification service) の初期化ファイルを作成し、DeviceTokenモデル（既存）を確認。両プラットフォームに対応した統一的な通知送信インターフェースを提供。

**Timestamp:** 2026-01-22T12:47:42.947Z
**Log ID:** 36595019-20c9-4cad-9267-f7b74231095b

---

## Statistics

- **Lines Added:** +650
- **Lines Removed:** -0
- **Files Changed:** 5
- **Net Change:** 650

## Files Modified
_No files modified_

## Files Created
- backend/config/initializers/fcm.rb
- backend/config/initializers/rpush.rb
- backend/spec/initializers/fcm_spec.rb
- backend/spec/initializers/rpush_spec.rb
- backend/spec/models/device_token_spec.rb

---

## Artifacts

### Functions

#### FcmClient.send_notification
- **Purpose:** 単一のAndroidデバイスにFCM経由でプッシュ通知を送信
- **Location:** backend/config/initializers/fcm.rb:40
- **Signature:** (token:, title:, body:, data: {}, options: {}) -> Hash
- **Exported:** Yes

#### FcmClient.send_to_devices
- **Purpose:** 複数のAndroidデバイスにFCM経由でプッシュ通知を一括送信
- **Location:** backend/config/initializers/fcm.rb:54
- **Signature:** (tokens:, title:, body:, data: {}) -> Array<Hash>
- **Exported:** Yes

#### ApnsClient.send_notification
- **Purpose:** 単一のiOSデバイスにAPNs経由でプッシュ通知を送信
- **Location:** backend/config/initializers/rpush.rb:40
- **Signature:** (token:, title:, body:, data: {}, options: {}) -> Hash
- **Exported:** Yes

#### ApnsClient.send_to_devices
- **Purpose:** 複数のiOSデバイスにAPNs経由でプッシュ通知を一括送信
- **Location:** backend/config/initializers/rpush.rb:53
- **Signature:** (tokens:, title:, body:, data: {}) -> Array<Hash>
- **Exported:** Yes

### Classes

#### FcmClient
- **Purpose:** Firebase Cloud Messaging (FCM) を使用してAndroidデバイスにプッシュ通知を送信するモジュール
- **Location:** backend/config/initializers/fcm.rb:24
- **Methods:** send_notification, send_to_devices, configured?, project_id
- **Exported:** Yes

#### ApnsClient
- **Purpose:** Apple Push Notification service (APNs) を使用してiOSデバイスにプッシュ通知を送信するモジュール
- **Location:** backend/config/initializers/rpush.rb:28
- **Methods:** send_notification, send_to_devices, configured?, environment, bundle_id
- **Exported:** Yes

### Integrations

#### Integration
- **Description:** FcmClientはfcm gemを使用してFirebase Cloud Messaging HTTP v1 APIと連携し、Androidデバイスに通知を送信
- **Frontend Component:** N/A (Backend only)
- **Backend Endpoint:** FCM HTTP v1 API (https://fcm.googleapis.com/v1/projects)
- **Data Flow:** FcmClient -> FCM gem -> Firebase Cloud Messaging API -> Android device

#### Integration
- **Description:** ApnsClientはrpush gemを使用してApple Push Notification serviceと連携し、iOSデバイスに通知を送信
- **Frontend Component:** N/A (Backend only)
- **Backend Endpoint:** APNs (via rpush daemon)
- **Data Flow:** ApnsClient -> rpush -> APNs -> iOS device

#### Integration
- **Description:** DeviceTokenモデルはユーザーのデバイストークンを管理し、プラットフォーム（ios/android）ごとにトークンを保存・検索
- **Frontend Component:** N/A (Model)
- **Backend Endpoint:** N/A (Database)
- **Data Flow:** Mobile app registers token -> API -> DeviceToken model -> Database

