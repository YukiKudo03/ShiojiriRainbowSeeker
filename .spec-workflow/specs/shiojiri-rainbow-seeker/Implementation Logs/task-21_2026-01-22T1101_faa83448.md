# Implementation Log: Task 21

**Summary:** RainViewer API連携モジュールを実装。雨雲レーダーデータの取得、タイル座標計算、降水強度分類、予測データ（Nowcast）取得機能を提供。RainViewerは無料APIでAPIキー不要。

**Timestamp:** 2026-01-22T11:01:48.785Z
**Log ID:** faa83448-1525-4d35-8935-5270f61b114b

---

## Statistics

- **Lines Added:** +510
- **Lines Removed:** -0
- **Files Changed:** 2
- **Net Change:** 510

## Files Modified
_No files modified_

## Files Created
- backend/lib/external_apis/radar_api.rb
- backend/spec/lib/external_apis/radar_api_spec.rb

---

## Artifacts

### Functions

#### get_radar_data
- **Purpose:** 指定位置の雨雲レーダーデータを取得（タイルURL、座標、Nowcast情報）
- **Location:** backend/lib/external_apis/radar_api.rb:69
- **Signature:** (lat: Float, lng: Float, timestamp: Time|Integer|nil, zoom: Integer) -> Hash
- **Exported:** Yes

#### get_precipitation_timeline
- **Purpose:** 時系列の降水データを取得
- **Location:** backend/lib/external_apis/radar_api.rb:103
- **Signature:** (lat: Float, lng: Float, count: Integer) -> Array<Hash>
- **Exported:** Yes

#### get_nowcast
- **Purpose:** 予測データ（Nowcast）を取得
- **Location:** backend/lib/external_apis/radar_api.rb:121
- **Signature:** (lat: Float, lng: Float) -> Array<Hash>
- **Exported:** Yes

#### classify_intensity
- **Purpose:** レーダー反射強度（dBZ）から降水強度レベルを判定
- **Location:** backend/lib/external_apis/radar_api.rb:148
- **Signature:** (dbz: Integer) -> Hash{level, mm_h, description}
- **Exported:** Yes

### Classes

#### ExternalApis::RadarApi
- **Purpose:** RainViewer API連携モジュール - 雨雲レーダーデータを取得
- **Location:** backend/lib/external_apis/radar_api.rb
- **Methods:** initialize(timeout:), available_timestamps, get_radar_data(lat:, lng:, timestamp:, zoom:), get_precipitation_timeline(lat:, lng:, count:), get_nowcast(lat:, lng:), estimate_movement(lat:, lng:), classify_intensity(dbz)
- **Exported:** Yes

### Integrations

#### Integration
- **Description:** RainViewer API との連携（無料、APIキー不要）
- **Frontend Component:** N/A (Backend module)
- **Backend Endpoint:** https://api.rainviewer.com/public/weather-maps.json
- **Data Flow:** RadarApi -> Faraday HTTP Client -> RainViewer API -> Parse JSON -> Generate Tile URLs -> Return Hash

