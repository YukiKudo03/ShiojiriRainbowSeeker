# 要件定義書

## 概要

**塩尻レインボーシーカー（ShiojiriRainbowSeeker）** は、塩尻市およびその周辺地域の住民や訪問者が虹の発見を共有し、楽しむためのコミュニティ主導型モバイルアプリケーションです。ユーザーはGPS位置情報とコメントを含む虹の写真を撮影・共有し、地域の虹の目撃情報のフォトギャラリーを構築できます。さらに、気象条件が虹の形成に適している場合にリアルタイム通知を送信し、この儚い自然現象を見逃さないようサポートします。

本アプリケーションは3つの主要な目的を果たします：
1. **虹の写真共有**: 位置情報とコメント付きの虹の写真をアップロードし、地域の虹目撃情報のビジュアルアーカイブを作成するコミュニティプラットフォーム
2. **虹出現通知**: 気象データ分析に基づき、虹が見える可能性がある大気条件を通知するプッシュ通知機能
3. **虹出現地域分析**: 虹の目撃情報と周辺の気象条件データを蓄積・分析し、虹の出やすい気象条件が発生しやすい地域か否かを判断するためのデータ基盤を提供

### 製品ビジョンとの整合性

本プロジェクトは塩尻レインボーシーカープラットフォームを新規に構築するものです。製品ビジョンの中心は以下の通りです：
- 自然現象への感謝を通じたコミュニティエンゲージメントの構築
- モバイル機能（GPS、カメラ、プッシュ通知）の活用
- ポジティブで心温まるコンテンツに焦点を当てた位置情報ベースのソーシャル体験の創出
- 塩尻地域における自然とのつながりと屋外への意識向上の促進

## ユーザーストーリー

### US-1: ユーザー登録
**ユーザーとして** 新規ユーザー
**私は** アカウントを作成し、安全にログインしたい
**なぜなら** 虹の写真を保存し、パーソナライズされた通知を受け取りたいから

### US-2: 虹の写真撮影
**ユーザーとして** 登録済みユーザー
**私は** 位置情報が自動的にタグ付けされた虹の写真を撮影またはアップロードしたい
**なぜなら** 虹の目撃情報をコミュニティと共有したいから

### US-3: 写真コメント
**ユーザーとして** 登録済みユーザー
**私は** 虹の写真にコメントや説明を追加したい
**なぜなら** 目撃時の状況を共有したいから

### US-4: ギャラリー閲覧
**ユーザーとして** ユーザー（登録済みまたはゲスト）
**私は** コミュニティが共有した虹の写真を閲覧したい
**なぜなら** 地域全体の虹の目撃情報を楽しみ、発見したいから

### US-5: マップ探索
**ユーザーとして** ユーザー
**私は** 虹の目撃情報を地図上で確認したい
**なぜなら** どこで虹が目撃されたか地理的に発見したいから

### US-6: 虹通知
**ユーザーとして** 登録済みユーザー
**私は** 虹が見える可能性が高い条件の時にプッシュ通知を受け取りたい
**なぜなら** 虹を見るチャンスを逃したくないから

### US-7: 通知設定
**ユーザーとして** 登録済みユーザー
**私は** 通知設定をカスタマイズしたい
**なぜなら** 自分に関連のある通知だけを受け取りたいから

### US-8: ソーシャルインタラクション
**ユーザーとして** 登録済みユーザー
**私は** 他のユーザーの虹の写真に反応（いいね、コメント）したい
**なぜなら** コミュニティと交流したいから

### US-9: プロフィール管理
**ユーザーとして** 登録済みユーザー
**私は** 自分のプロフィールを管理し、アップロードした写真を確認したい
**なぜなら** 自分の貢献を追跡し、体験をパーソナライズしたいから

### US-10: コンテンツモデレーション
**ユーザーとして** 管理者
**私は** 報告されたコンテンツを審査・管理したい
**なぜなら** 安全でポジティブなコミュニティ環境を維持したいから

### US-11: 初回オンボーディング
**ユーザーとして** 新規ユーザー
**私は** アプリの機能についてガイド付きの紹介を受けたい
**なぜなら** アプリの使い方をすぐに理解したいから

### US-12: データ管理
**ユーザーとして** 登録済みユーザー
**私は** 自分の個人データをエクスポートまたは削除したい
**なぜなら** 自分の情報をコントロールしたいから（GDPR準拠）

### US-13: 気象条件データ閲覧
**ユーザーとして** ユーザー
**私は** 虹の目撃情報とともに記録された気象条件データを閲覧したい
**なぜなら** どのような気象条件で虹が発生しやすいか理解し、虹の出やすい地域を知りたいから

## 機能要件

### FR-1: ユーザー認証
メール/パスワードログインをサポートする安全なユーザー登録・認証システム。

**優先度**: 高
**依存関係**: 認証用メールサービス

#### 受入基準
- [ ] **AC-1.1**: ユーザーが初めてアプリを開いた場合、システムは登録/ログインオプションを表示すること
- [ ] **AC-1.2**: ユーザーがメールとパスワードで登録した場合、システムはアカウントを作成しメール認証を送信すること
- [ ] **AC-1.3**: ユーザーが無効なメール形式を入力した場合、システムは適切なエラーメッセージを表示すること
- [ ] **AC-1.4**: ユーザーが有効な認証情報でログインした場合、システムは認証を行いメイン画面にリダイレクトすること
- [ ] **AC-1.5**: ユーザーが不正な認証情報を入力した場合、システムはエラーを表示しリトライを許可すること（一時ロックアウトまで最大5回）
- [ ] **AC-1.6**: ユーザーがパスワードリセットを要求した場合、システムは登録メールにリセットリンクを送信すること
- [ ] **AC-1.7**: メール認証が失敗した場合（無効なトークン、期限切れ）、システムはエラーを表示し再送信を提案すること

### FR-2: 写真撮影・アップロード
自動GPS タグ付けによる虹の写真の撮影または選択、およびプラットフォームへのアップロードを可能にする。

**優先度**: 高
**依存関係**: デバイスカメラアクセス、GPS/位置情報サービス、画像ストレージサービス

#### 受入基準
- [ ] **AC-2.1**: ユーザーがカメラボタンをタップした場合、システムは位置情報サービスを有効にしてデバイスカメラを開くこと
- [ ] **AC-2.2**: ユーザーが写真を撮影した場合、システムはGPS座標（緯度、経度）を画像メタデータに自動的に埋め込むこと
- [ ] **AC-2.3**: GPSが利用不可または不正確な場合、システムはマップ上での手動位置選択を許可すること
- [ ] **AC-2.4**: ユーザーがギャラリーから写真を選択した場合、システムは既存のGPSデータを抽出するか、位置入力を促すこと
- [ ] **AC-2.5**: 写真をアップロードする際、システムは画像をJPEG品質80%、最大ファイルサイズ2MBに圧縮すること
- [ ] **AC-2.6**: 写真のアップロードが成功した場合、システムは確認メッセージを表示すること
- [ ] **AC-2.7**: ネットワークエラーでアップロードが失敗した場合、システムは接続復旧時に自動リトライするようキューに追加すること
- [ ] **AC-2.8**: サーバーエラーでアップロードが失敗した場合、システムはユーザーに通知し手動リトライを許可すること
- [ ] **AC-2.9**: 圧縮前の写真ファイルサイズが10MBを超える場合、システムは小さい画像の選択を提案するエラーを表示すること

### FR-3: 写真コメント・メタデータ
虹の写真に説明情報を追加することを可能にする。

**優先度**: 中
**依存関係**: FR-2（写真アップロード）

#### 受入基準
- [ ] **AC-3.1**: ユーザーが写真をアップロードする際、システムはタイトル（任意、最大100文字）と説明/コメント（任意、最大500文字）のフィールドを提供すること
- [ ] **AC-3.2**: ユーザーがコメントを追加した場合、システムはタイムスタンプとともに写真と一緒に保存すること
- [ ] **AC-3.3**: コメントが500文字を超える場合、システムは残り文字数を表示し送信を防止すること
- [ ] **AC-3.4**: 写真を表示する際、システムは位置名（逆ジオコーディング）、日時、コメントを表示すること
- [ ] **AC-3.5**: ユーザーが自分の写真を表示する際、システムはタイトルとコメントの編集を許可すること

### FR-4: フォトギャラリー・フィード
フィルタリング機能を備えたコミュニティの虹の写真の閲覧可能なフィードを表示する。

**優先度**: 高
**依存関係**: FR-2（写真アップロード）、画像CDN

#### 受入基準
- [ ] **AC-4.1**: ユーザーがアプリを開いた場合、システムは日付順（最新順）にソートされた最近の虹の写真フィードを表示すること
- [ ] **AC-4.2**: ユーザーがフィードをスクロールした場合、システムは無限スクロールページネーション（1ページ20枚）で追加の写真を読み込むこと
- [ ] **AC-4.3**: ユーザーが写真をタップした場合、システムは位置、日付、コメントを含むフルスクリーン表示を表示すること
- [ ] **AC-4.4**: ユーザーが位置でフィルタリングした場合、システムは選択したエリア半径内の写真のみを表示すること
- [ ] **AC-4.5**: ユーザーが日付範囲でフィルタリングした場合、システムは指定期間内の写真を表示すること
- [ ] **AC-4.6**: ユーザーがキーワードで検索した場合、システムはタイトルまたはコメントが一致する写真を返すこと
- [ ] **AC-4.7**: 現在のフィルタ/検索に一致する写真がない場合、システムは提案を含む空の状態メッセージを表示すること
- [ ] **AC-4.8**: フィード読み込みが失敗した場合、システムはリトライオプション付きのエラーメッセージを表示すること

### FR-5: マップビュー
クラスタリングと位置情報ベースの機能を備えたインタラクティブな地図上に虹の目撃情報を表示する。

**優先度**: 中
**依存関係**: マッププロバイダーサービス（MapboxまたはGoogle Maps）

#### 受入基準
- [ ] **AC-5.1**: ユーザーがマップビューに切り替えた場合、システムは各虹の写真位置にマーカーのある地図を表示すること
- [ ] **AC-5.2**: ユーザーがマップマーカーをタップした場合、システムはその位置の写真のプレビューを表示すること
- [ ] **AC-5.3**: 複数の写真が互いに500メートル以内に存在する場合、システムはマーカーをクラスタリングしカウントを表示すること
- [ ] **AC-5.4**: ユーザーの位置が利用可能な場合、システムは初期状態で現在位置を中心に地図を表示すること
- [ ] **AC-5.5**: ユーザーが地図をズームまたはパンした場合、システムは表示領域内の関連マーカーを動的に読み込むこと
- [ ] **AC-5.6**: デバイスがオフラインの場合、システムは前回のセッションからキャッシュされた地図タイルとマーカーを表示すること

### FR-6: 虹通知システム
気象条件が虹の視認可能性を示す場合にプッシュ通知を送信する。

**優先度**: 高
**依存関係**: 気象APIサービス、プッシュ通知サービス（FCM/APNs）

#### 受入基準
- [ ] **AC-6.1**: ユーザーが通知を有効にした場合、システムは通知位置（現在のGPSまたはユーザー選択の固定位置）を登録すること
- [ ] **AC-6.2**: 気象条件が虹の可能性を示す場合（湿度70%以上、太陽角度が地平線から40-42度、30分以内の降水）、システムはプッシュ通知を送信すること
- [ ] **AC-6.3**: 通知を送信する際、見る可能性が高い方向（例：「東を見てください」）と推定視認時間を含めること
- [ ] **AC-6.4**: ユーザーが通知を無効にした場合、システムは直ちにアラートの送信を停止すること
- [ ] **AC-6.5**: 気象APIデータが30分以内に好条件を示唆する場合、システムは事前通知を送信すること
- [ ] **AC-6.6**: ユーザーが通知をタップした場合、システムはアプリをカメラ画面で開くこと
- [ ] **AC-6.7**: 2時間以内に複数の好条件が発生した場合、システムは最大1件の通知を送信すること（スロットリング）
- [ ] **AC-6.8**: 気象APIが利用不可の場合、システムは通知チェックをスキップし次の間隔でリトライすること

### FR-7: 通知設定
パーソナライズされたアラートのための通知設定のカスタマイズを可能にする。

**優先度**: 中
**依存関係**: FR-6（通知システム）

#### 受入基準
- [ ] **AC-7.1**: ユーザーが設定にアクセスした場合、システムは通知設定オプションを表示すること
- [ ] **AC-7.2**: ユーザーが位置半径を設定した場合（1km、5km、10km、25kmオプション）、システムはそのエリア内の条件に対してのみ通知を送信すること
- [ ] **AC-7.3**: ユーザーが静寂時間を設定した場合（開始時刻、終了時刻）、システムはその時間帯に通知を送信しないこと
- [ ] **AC-7.4**: ユーザーが通知タイプを切り替えた場合、システムは個別の設定を尊重すること（虹アラート、コミュニティ活動を別々に）
- [ ] **AC-7.5**: 設定が保存された場合、システムはセッション間で永続化し、クロスデバイス一貫性のためサーバーに同期すること
- [ ] **AC-7.6**: 静寂時間が事前通知のタイミングと競合する場合、システムは静寂時間終了まで通知を延期すること

### FR-8: ソーシャルインタラクション
写真へのいいねとコメントを通じたコミュニティエンゲージメントを可能にする。

**優先度**: 中
**依存関係**: FR-4（ギャラリー）

#### 受入基準
- [ ] **AC-8.1**: ユーザーが写真のいいねボタンをタップした場合、システムはいいね数を増加させインタラクションを記録すること
- [ ] **AC-8.2**: ユーザーが写真にコメントした場合、システムはタイムスタンプとともに写真のコメントスレッドに追加すること
- [ ] **AC-8.3**: ユーザーが自分の写真にいいねまたはコメントを受け取った場合、システムは通知を送信すること（有効な場合）
- [ ] **AC-8.4**: ユーザーが写真を表示する際、システムは総いいね数とコメント数を表示すること
- [ ] **AC-8.5**: ユーザーが不適切なコンテンツを報告した場合、システムは審査のためフラグを立て、報告を確認し、報告者からコンテンツを非表示にすること
- [ ] **AC-8.6**: コメントに禁止ワードが含まれる場合、システムは送信をブロックし警告を表示すること
- [ ] **AC-8.7**: ユーザーが同じ写真に2回いいねしようとした場合、システムは前回のいいねをトグル（いいね解除）すること

### FR-9: ユーザープロフィール
プロフィール管理と個人フォトギャラリーへのアクセスを提供する。

**優先度**: 中
**依存関係**: FR-1（認証）、FR-2（写真アップロード）

#### 受入基準
- [ ] **AC-9.1**: ユーザーがプロフィールにアクセスした場合、システムはユーザー名、プロフィール写真、統計（アップロード写真数、受け取ったいいね数、総コメント数）を表示すること
- [ ] **AC-9.2**: ユーザーがプロフィールを編集する際、システムは表示名（3-30文字）とプロフィール写真の変更を許可すること
- [ ] **AC-9.3**: ユーザーが「マイフォト」を表示する際、システムはアップロードしたすべての虹の写真をグリッド表示すること
- [ ] **AC-9.4**: ユーザーが写真を削除する際、システムは確認ダイアログを表示し、確認後にギャラリーから削除すること
- [ ] **AC-9.5**: ユーザーがログアウトした場合、システムはローカルセッションデータをクリアしログイン画面に戻ること

### FR-10: コンテンツモデレーション
管理者が報告されたコンテンツを審査・管理することを可能にする。

**優先度**: 中
**依存関係**: FR-8（ソーシャルインタラクション）

#### 受入基準
- [ ] **AC-10.1**: コンテンツが報告された場合、システムは報告理由と報告者情報とともにモデレーションキューに追加すること
- [ ] **AC-10.2**: 管理者がコンテンツを審査する際、システムは承認（報告却下）、非表示（公開ビューから削除）、または削除（永久削除）のアクションを許可すること
- [ ] **AC-10.3**: コンテンツが非表示または削除された場合、システムはコンテンツ所有者に理由とともに通知すること
- [ ] **AC-10.4**: ユーザーが複数のコンテンツ違反（3件以上）を受けた場合、システムはそのアカウントを審査対象としてフラグを立てること

### FR-11: オンボーディングフロー
初回起動時に新規ユーザーにアプリ機能をガイドする。

**優先度**: 低
**依存関係**: なし

#### 受入基準
- [ ] **AC-11.1**: ユーザーが登録を完了した場合、システムはオプションのオンボーディングフロー（スキップ可能）を表示すること
- [ ] **AC-11.2**: オンボーディングが表示される際、写真撮影、ギャラリー閲覧、マップビュー、通知をカバーする4-5画面を含めること
- [ ] **AC-11.3**: ユーザーがオンボーディングを完了またはスキップした場合、システムは完了としてマークし再度表示しないこと
- [ ] **AC-11.4**: ユーザーがオンボーディングを再訪問したい場合、設定メニューからアクセス可能であること

### FR-12: データエクスポート・削除
GDPR準拠のためユーザーが個人データをエクスポートまたは削除することを可能にする。

**優先度**: 中
**依存関係**: FR-1（認証）、FR-2（写真アップロード）

#### 受入基準
- [ ] **AC-12.1**: ユーザーがデータエクスポートを要求した場合、システムは48時間以内に写真、コメント、プロフィールデータを含むダウンロード可能なアーカイブ（ZIP）を生成すること
- [ ] **AC-12.2**: ユーザーがアカウント削除を要求した場合、システムは結果と14日間の猶予期間を含む確認を表示すること
- [ ] **AC-12.3**: 猶予期間がキャンセルなしで経過した場合、システムはすべてのユーザーデータを永久に削除すること
- [ ] **AC-12.4**: データが削除された場合、システムはCDNから写真を削除し、データベースレコードを削除し、残りの参照を匿名化すること

### FR-13: 気象条件データ記録・分析
虹の目撃情報の前後数時間の周辺気象条件情報を自動的に記録し、虹出現パターンの分析基盤を提供する。

**優先度**: 高
**依存関係**: FR-2（写真アップロード）、気象APIサービス、雨雲レーダーAPI

#### 受入基準
- [ ] **AC-13.1**: 虹の写真がアップロードされた場合、システムは目撃時刻の前後3時間（計6時間）の気象条件データを自動的に取得・記録すること
- [ ] **AC-13.2**: 記録する気象条件データには以下を含むこと：
  - 雨雲レーダー情報（降水量、降水エリア、移動方向）
  - 気温、湿度、気圧
  - 風向、風速（気流条件）
  - 太陽の位置（方角、高度）
  - 天候状態（晴れ、曇り、雨など）
- [ ] **AC-13.3**: ユーザーが写真詳細画面を表示する際、システムは記録された気象条件データのサマリーを表示すること
- [ ] **AC-13.4**: ユーザーが「気象条件詳細」をタップした場合、システムは時系列グラフと雨雲レーダーの推移を表示すること
- [ ] **AC-13.5**: システムは地域ごとの虹出現統計（虹が出やすい時間帯、気象パターン、季節傾向）を集計し、マップビューで「虹出現頻度ヒートマップ」として表示できること
- [ ] **AC-13.6**: ユーザーが特定の地域をタップした場合、システムはその地域の虹出現傾向（過去の出現回数、典型的な気象条件）を表示すること
- [ ] **AC-13.7**: 気象APIからデータ取得が失敗した場合、システムは取得可能なデータのみを記録し、失敗した項目はnullとして保存すること
- [ ] **AC-13.8**: 記録された気象条件データは、将来の虹出現予測精度向上のための機械学習データセットとしてエクスポート可能であること

## 技術的制約

- **モバイルプラットフォーム**: iOS 14以上、Android APIレベル26以上（Android 8.0以上）
- **フレームワーク**: React NativeまたはFlutterを使用したクロスプラットフォーム開発
- **バックエンド**: Node.js with Express または同等のREST APIフレームワーク
- **データベース**: PostgreSQL（リレーショナルデータ用）、PostGIS拡張機能（地理空間クエリ用）
- **気象APIレート制限**: 無料枠で最大60コール/分; APIコールを削減するためキャッシングを実装
- **プッシュ通知制限**: FCMにはハードリミットなし; APNsは証明書管理が必要
- **画像ストレージ**: ユーザーあたり最大10GB; 非アクティブアカウントのクリーンアップポリシーを実装

## 依存関係

| 依存関係 | 目的 | プロバイダーオプション |
|----------|------|------------------------|
| 気象API | 虹条件検出、気象データ記録 | OpenWeatherMap、WeatherAPI、Visual Crossing |
| 雨雲レーダーAPI | 降水情報、雨雲移動予測 | 気象庁API、OpenWeatherMap Radar、RainViewer API |
| マッププロバイダー | 地図表示とジオコーディング | Google Maps、Mapbox、Apple Maps |
| プッシュ通知 | リアルタイムアラート | Firebase Cloud Messaging（Android）、APNs（iOS） |
| 画像ストレージ/CDN | 写真保存と配信 | AWS S3 + CloudFront、Cloudflare R2、Google Cloud Storage |
| メールサービス | 認証と通知 | SendGrid、AWS SES、Mailgun |
| ジオロケーション | 逆ジオコーディング | Google Geocoding API、Mapbox Geocoding |
| 太陽位置計算 | 太陽の方角・高度算出 | SunCalc ライブラリ、Astronomy API |

## スコープ外

以下の項目はこのバージョンには明示的に含まれません：

- Webアプリケーション（v1.0はモバイルのみ）
- カスタム虹予測アルゴリズムの開発（既存の気象APIデータを使用）
- 有料/プレミアムサブスクリプション機能
- SNS共有連携（Instagram、Twitter等）
- 動画撮影・共有
- ユーザー間のリアルタイムチャットやメッセージング
- 虹通知以外の天気予報表示
- 塩尻エリア以外への複数地域展開（v1.0は塩尻に焦点）
- AR（拡張現実）機能

## 非機能要件

### NFR-1: コードアーキテクチャとモジュール性
- **単一責任原則**: 各ファイルは単一の明確に定義された目的を持つこと（例：認証、写真、通知の別々のサービス）
- **モジュラー設計**: コンポーネント、ユーティリティ、サービスは分離され再利用可能であること
- **依存関係管理**: モジュール間の相互依存を最小化; 適切な場合は依存性注入を使用
- **明確なインターフェース**: コンポーネントとレイヤー間（API、サービス、データ、プレゼンテーション）の明確な契約を定義

### NFR-2: パフォーマンス
- 写真アップロードは10Mbps接続で10秒以内に完了すること
- フィード読み込みは2秒以内に初期コンテンツを表示すること
- マップレンダリングはパン/ズーム操作中に60fpsを維持すること
- プッシュ通知は好天検出から5分以内に配信されること
- アプリ起動から使用可能状態までミッドレンジデバイスで3秒未満であること

### NFR-3: セキュリティ
- すべてのAPI通信はHTTPS/TLS 1.3を使用すること
- ユーザーパスワードは最低12ラウンドのソルトでbcryptを使用してハッシュ化すること
- 適切な有効期限を持つJWTトークンによる認証（アクセス: 15分、リフレッシュ: 7日）
- 写真メタデータは選択した表示名と位置以外の機密ユーザー情報を公開しないこと
- 認証エンドポイントにレート制限を実装（IPあたり1分間最大10回試行）
- XSSおよびSQLインジェクション攻撃を防ぐための入力サニタイズ

### NFR-4: 信頼性
- システムは99.5%のアップタイム可用性を維持すること
- 写真アップロードは中断された接続に対する再開機能をサポートすること
- オフラインモードは写真撮影を許可し、接続復旧時に自動アップロードすること
- データベースは30日間の保持と特定時点復旧機能を持つ毎日のバックアップを実装すること
- 外部サービス（気象API、マップ）が利用不可の場合のグレースフルデグラデーション

### NFR-5: ユーザビリティ
- アプリは英語と日本語の両方をサポートすること
- UIはWCAG 2.1 AAガイドラインに従いアクセシブルであること
- タッチターゲットは最小44x44ポイントであること
- アプリはライトモードとダークモードの両テーマをサポートすること
- オンボーディングフローは2分以内に主要機能を紹介すること
- エラーメッセージはユーザーフレンドリーで対処可能であること

### NFR-6: スケーラビリティ
- アーキテクチャはユーザー負荷増加に対する水平スケーリングをサポートすること
- 画像ストレージはグローバルで200ms未満のターゲットレイテンシで効率的な配信のためCDNを使用すること
- データベース設計は100,000枚以上の写真と10,000人以上のユーザーへの成長に対応すること
- API設計は効率的なデータ取得のためのページネーションとフィルタリングをサポートすること

### NFR-7: プライバシーとデータ保護
- GDPRおよび日本の個人情報保護法（APPI）に準拠すること
- ユーザーは位置データ収集に明示的に同意する必要があること
- 位置データの精度は設定可能であること（正確 vs. おおよそ）
- データ保持ポリシー: 非アクティブアカウントは2年後にアーカイブ、3年後に削除
- プライバシーポリシーと利用規約はアプリ内でアクセス可能であること

### NFR-8: ロギングとモニタリング
- すべてのAPIリクエストはタイムスタンプ、エンドポイント、応答時間、ステータスコードでログ記録されること
- エラートラッキングはスタックトレースとユーザーコンテキスト（匿名化）をキャプチャすること
- システムヘルスメトリクス（CPU、メモリ、データベース接続）が監視されること
- アラートしきい値はエラーレート5%超または応答時間3秒超で通知をトリガーすること

## 用語集

| 用語 | 定義 |
|------|------|
| 虹の可能性 | 虹形成に適した気象条件: 湿度70%超、太陽角度が地平線から40-42°、30分以内の降水 |
| 雨雲レーダー | 降水エリア、降水量、雨雲の移動方向をリアルタイムで可視化する気象レーダーデータ |
| 気流条件 | 風向、風速などの大気の流れに関するデータ。虹の形成や持続時間に影響を与える |
| 虹出現頻度ヒートマップ | 地域ごとの虹の目撃頻度を色の濃淡で可視化した地図表示 |
| 気象条件データ | 虹目撃時の前後に記録される気象情報（雨雲、気温、湿度、気圧、風向風速、太陽位置など） |
| ジオコーディング | GPS座標を人間が読める住所に変換すること |
| 逆ジオコーディング | 住所をGPS座標に変換すること |
| EARS形式 | WHEN/IF/THEN文を使用した要件構文への簡単なアプローチ |
| CDN | 分散コンテンツ配信のためのコンテンツ配信ネットワーク |
| プッシュ通知 | サーバーから開始されユーザーのデバイスに配信されるメッセージ |
| 静寂時間 | 通知が抑制されるユーザー定義の時間帯 |
| クラスタリング | 近接するマップマーカー（500m以内）をカウントを表示する単一のマーカーにグループ化すること |
